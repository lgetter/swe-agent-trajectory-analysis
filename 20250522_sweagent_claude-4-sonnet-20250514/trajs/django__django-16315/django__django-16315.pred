{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-16315", "model_patch": "diff --git a/django/db/backends/mysql/operations.py b/django/db/backends/mysql/operations.py\nindex 76ca815765..7bbcedbc89 100644\n--- a/django/db/backends/mysql/operations.py\n+++ b/django/db/backends/mysql/operations.py\n@@ -451,8 +451,8 @@ class DatabaseOperations(BaseDatabaseOperations):\n \n             fields = \", \".join(\n                 [\n-                    field_sql % {\"field\": field}\n-                    for field in map(self.quote_name, update_fields)\n+                    field_sql % {\"field\": self.quote_name(field.column)}\n+                    for field in update_fields\n                 ]\n             )\n             return conflict_suffix_sql % {\"fields\": fields}\ndiff --git a/django/db/backends/postgresql/operations.py b/django/db/backends/postgresql/operations.py\nindex 62273fc43c..b6187fc156 100644\n--- a/django/db/backends/postgresql/operations.py\n+++ b/django/db/backends/postgresql/operations.py\n@@ -354,11 +354,11 @@ class DatabaseOperations(BaseDatabaseOperations):\n             return \"ON CONFLICT DO NOTHING\"\n         if on_conflict == OnConflict.UPDATE:\n             return \"ON CONFLICT(%s) DO UPDATE SET %s\" % (\n-                \", \".join(map(self.quote_name, unique_fields)),\n+                \", \".join(self.quote_name(field.column) for field in unique_fields),\n                 \", \".join(\n                     [\n-                        f\"{field} = EXCLUDED.{field}\"\n-                        for field in map(self.quote_name, update_fields)\n+                        f\"{self.quote_name(field.column)} = EXCLUDED.{self.quote_name(field.column)}\"\n+                        for field in update_fields\n                     ]\n                 ),\n             )\ndiff --git a/django/db/backends/sqlite3/operations.py b/django/db/backends/sqlite3/operations.py\nindex bb84d52071..4787f97c42 100644\n--- a/django/db/backends/sqlite3/operations.py\n+++ b/django/db/backends/sqlite3/operations.py\n@@ -418,11 +418,11 @@ class DatabaseOperations(BaseDatabaseOperations):\n             and self.connection.features.supports_update_conflicts_with_target\n         ):\n             return \"ON CONFLICT(%s) DO UPDATE SET %s\" % (\n-                \", \".join(map(self.quote_name, unique_fields)),\n+                \", \".join(self.quote_name(field.column) for field in unique_fields),\n                 \", \".join(\n                     [\n-                        f\"{field} = EXCLUDED.{field}\"\n-                        for field in map(self.quote_name, update_fields)\n+                        f\"{self.quote_name(field.column)} = EXCLUDED.{self.quote_name(field.column)}\"\n+                        for field in update_fields\n                     ]\n                 ),\n             )\ndiff --git a/django/db/models/query.py b/django/db/models/query.py\nindex be8580f2c4..b71189be98 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -698,7 +698,7 @@ class QuerySet(AltersData):\n                 raise NotSupportedError(\n                     \"This database backend does not support ignoring conflicts.\"\n                 )\n-            return OnConflict.IGNORE\n+            return OnConflict.IGNORE, [], []\n         elif update_conflicts:\n             if not db_features.supports_update_conflicts:\n                 raise NotSupportedError(\n@@ -720,28 +720,29 @@ class QuerySet(AltersData):\n                     \"Unique fields that can trigger the upsert must be provided.\"\n                 )\n             # Updating primary keys and non-concrete fields is forbidden.\n-            update_fields = [self.model._meta.get_field(name) for name in update_fields]\n-            if any(not f.concrete or f.many_to_many for f in update_fields):\n+            update_field_objects = [self.model._meta.get_field(name) for name in update_fields]\n+            if any(not f.concrete or f.many_to_many for f in update_field_objects):\n                 raise ValueError(\n                     \"bulk_create() can only be used with concrete fields in \"\n                     \"update_fields.\"\n                 )\n-            if any(f.primary_key for f in update_fields):\n+            if any(f.primary_key for f in update_field_objects):\n                 raise ValueError(\n                     \"bulk_create() cannot be used with primary keys in \"\n                     \"update_fields.\"\n                 )\n+            unique_field_objects = []\n             if unique_fields:\n-                unique_fields = [\n+                unique_field_objects = [\n                     self.model._meta.get_field(name) for name in unique_fields\n                 ]\n-                if any(not f.concrete or f.many_to_many for f in unique_fields):\n+                if any(not f.concrete or f.many_to_many for f in unique_field_objects):\n                     raise ValueError(\n                         \"bulk_create() can only be used with concrete fields \"\n                         \"in unique_fields.\"\n                     )\n-            return OnConflict.UPDATE\n-        return None\n+            return OnConflict.UPDATE, update_field_objects, unique_field_objects\n+        return None, [], []\n \n     def bulk_create(\n         self,\n@@ -788,7 +789,7 @@ class QuerySet(AltersData):\n             unique_fields = [\n                 opts.pk.name if name == \"pk\" else name for name in unique_fields\n             ]\n-        on_conflict = self._check_bulk_create_options(\n+        on_conflict, update_field_objects, unique_field_objects = self._check_bulk_create_options(\n             ignore_conflicts,\n             update_conflicts,\n             update_fields,\n@@ -806,8 +807,8 @@ class QuerySet(AltersData):\n                     fields,\n                     batch_size,\n                     on_conflict=on_conflict,\n-                    update_fields=update_fields,\n-                    unique_fields=unique_fields,\n+                    update_fields=update_field_objects,\n+                    unique_fields=unique_field_objects,\n                 )\n                 for obj_with_pk, results in zip(objs_with_pk, returned_columns):\n                     for result, field in zip(results, opts.db_returning_fields):\n@@ -823,8 +824,8 @@ class QuerySet(AltersData):\n                     fields,\n                     batch_size,\n                     on_conflict=on_conflict,\n-                    update_fields=update_fields,\n-                    unique_fields=unique_fields,\n+                    update_fields=update_field_objects,\n+                    unique_fields=unique_field_objects,\n                 )\n                 connection = connections[self.db]\n                 if (\n"}