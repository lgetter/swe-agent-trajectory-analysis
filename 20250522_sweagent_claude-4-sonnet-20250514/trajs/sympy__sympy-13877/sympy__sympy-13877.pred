{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "sympy__sympy-13877", "model_patch": "diff --git a/reproduce_error.py b/reproduce_error.py\nnew file mode 100644\nindex 0000000000..776f7a78cf\n--- /dev/null\n+++ b/reproduce_error.py\n@@ -0,0 +1,33 @@\n+#!/usr/bin/env python3\n+\n+from sympy import *\n+from sympy.abc import a\n+\n+def test_determinant_issue():\n+    \"\"\"Reproduce the determinant issue with symbolic entries\"\"\"\n+    print(\"Testing matrix determinant with symbolic entries...\")\n+    \n+    f = lambda n: det(Matrix([[i + a*j for i in range(n)] for j in range(n)]))\n+    \n+    # Test cases that should work\n+    print(\"f(1) =\", f(1))\n+    print(\"f(2) =\", f(2))\n+    print(\"f(3) =\", f(3))\n+    print(\"f(4) =\", f(4))\n+    \n+    # Test case that returns nan\n+    try:\n+        result = f(5)\n+        print(\"f(5) =\", result)\n+    except Exception as e:\n+        print(\"f(5) failed with:\", type(e).__name__, str(e))\n+    \n+    # Test case that raises the error\n+    try:\n+        result = f(6)\n+        print(\"f(6) =\", result)\n+    except Exception as e:\n+        print(\"f(6) failed with:\", type(e).__name__, str(e))\n+\n+if __name__ == \"__main__\":\n+    test_determinant_issue()\n\\ No newline at end of file\ndiff --git a/sympy/matrices/matrices.py b/sympy/matrices/matrices.py\nindex 97cde62e26..16d213fc41 100644\n--- a/sympy/matrices/matrices.py\n+++ b/sympy/matrices/matrices.py\n@@ -213,7 +213,15 @@ def entry(i, j):\n \n             return sign*bareiss(self._new(mat.rows - 1, mat.cols - 1, entry), pivot_val)\n \n-        return cancel(bareiss(self))\n+        try:\n+            return cancel(bareiss(self))\n+        except (TypeError, ValueError) as e:\n+            # If Bareiss algorithm fails (e.g., due to NaN comparison issues),\n+            # fall back to a more robust algorithm\n+            if \"Invalid NaN comparison\" in str(e) or \"NaN\" in str(e):\n+                return self._eval_det_berkowitz()\n+            else:\n+                raise\n \n     def _eval_det_berkowitz(self):\n         \"\"\" Use the Berkowitz algorithm to compute the determinant.\"\"\"\ndiff --git a/test_algorithms.py b/test_algorithms.py\nnew file mode 100644\nindex 0000000000..40fe8f7252\n--- /dev/null\n+++ b/test_algorithms.py\n@@ -0,0 +1,36 @@\n+#!/usr/bin/env python3\n+\n+from sympy import *\n+from sympy.abc import a\n+\n+def test_different_algorithms():\n+    \"\"\"Test different determinant algorithms\"\"\"\n+    print(\"Testing different determinant algorithms...\")\n+    \n+    # Create the problematic 6x6 matrix\n+    mat = Matrix([[i + a*j for i in range(6)] for j in range(6)])\n+    print(\"Matrix created successfully\")\n+    \n+    # Test Berkowitz algorithm\n+    try:\n+        result_berkowitz = mat.det(method=\"berkowitz\")\n+        print(\"Berkowitz result:\", result_berkowitz)\n+    except Exception as e:\n+        print(\"Berkowitz failed with:\", type(e).__name__, str(e))\n+    \n+    # Test LU algorithm\n+    try:\n+        result_lu = mat.det(method=\"lu\")\n+        print(\"LU result:\", result_lu)\n+    except Exception as e:\n+        print(\"LU failed with:\", type(e).__name__, str(e))\n+    \n+    # Test Bareiss algorithm (should fail)\n+    try:\n+        result_bareiss = mat.det(method=\"bareiss\")\n+        print(\"Bareiss result:\", result_bareiss)\n+    except Exception as e:\n+        print(\"Bareiss failed with:\", type(e).__name__, str(e))\n+\n+if __name__ == \"__main__\":\n+    test_different_algorithms()\n\\ No newline at end of file\n"}