{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-10554", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 08d7faf194..26caaa16d8 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -328,6 +328,9 @@ class Query(BaseExpression):\n             obj.subq_aliases = self.subq_aliases.copy()\n         obj.used_aliases = self.used_aliases.copy()\n         obj._filtered_relations = self._filtered_relations.copy()\n+        # Clone combined_queries to avoid sharing query objects\n+        if self.combined_queries:\n+            obj.combined_queries = tuple(query.clone() for query in self.combined_queries)\n         # Clear the cached_property\n         try:\n             del obj.base_table\ndiff --git a/tests/queries/test_qs_combinators.py b/tests/queries/test_qs_combinators.py\nindex 227972e8c4..142788853e 100644\n--- a/tests/queries/test_qs_combinators.py\n+++ b/tests/queries/test_qs_combinators.py\n@@ -228,3 +228,40 @@ class QuerySetSetOperationTests(TestCase):\n         qs1 = Number.objects.all()\n         qs2 = Number.objects.intersection(Number.objects.filter(num__gt=1))\n         self.assertEqual(qs1.difference(qs2).count(), 2)\n+\n+    def test_union_queryset_isolation(self):\n+        \"\"\"\n+        Test that creating a derived queryset from a union queryset doesn't\n+        break the original queryset due to shared state in combined_queries.\n+        \n+        Regression test for issue where union querysets with ordering would\n+        break when a derived queryset was created that changed the select clause.\n+        \"\"\"\n+        qs1 = Number.objects.filter(num__lte=1)\n+        qs2 = Number.objects.filter(num__gte=8)\n+        \n+        # Create a union queryset with ordering\n+        union_qs = qs1.union(qs2).order_by('num')\n+        \n+        # Create a derived queryset that changes the select clause\n+        derived_qs = union_qs.order_by().values_list('num', flat=True)\n+        \n+        # Verify that the queries are properly isolated\n+        self.assertIsNot(union_qs.query, derived_qs.query)\n+        if union_qs.query.combined_queries and derived_qs.query.combined_queries:\n+            self.assertIsNot(\n+                union_qs.query.combined_queries,\n+                derived_qs.query.combined_queries\n+            )\n+            self.assertIsNot(\n+                union_qs.query.combined_queries[0],\n+                derived_qs.query.combined_queries[0]\n+            )\n+        \n+        # Both querysets should work independently\n+        derived_result = list(derived_qs)\n+        union_result = list(union_qs)\n+        \n+        # Verify results\n+        self.assertEqual(set(derived_result), {0, 1, 8, 9})\n+        self.assertEqual(set(num.num for num in union_result), {0, 1, 8, 9})\n"}