{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-16661", "model_patch": "diff --git a/django/contrib/admin/options.py b/django/contrib/admin/options.py\nindex 5240b07cd6..4126a4c20f 100644\n--- a/django/contrib/admin/options.py\n+++ b/django/contrib/admin/options.py\n@@ -454,7 +454,8 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):\n \n         relation_parts = []\n         prev_field = None\n-        for part in lookup.split(LOOKUP_SEP):\n+        lookup_parts = lookup.split(LOOKUP_SEP)\n+        for i, part in enumerate(lookup_parts):\n             try:\n                 field = model._meta.get_field(part)\n             except FieldDoesNotExist:\n@@ -464,11 +465,31 @@ class BaseModelAdmin(metaclass=forms.MediaDefiningClass):\n             # It is allowed to filter on values that would be found from local\n             # model anyways. For example, if you filter on employee__department__id,\n             # then the id value would be found already from employee__department_id.\n+            # However, if we're traversing through the field to access other fields,\n+            # we must include it in the relation_parts.\n             if not prev_field or (\n                 prev_field.is_relation\n                 and field not in prev_field.path_infos[-1].target_fields\n             ):\n                 relation_parts.append(part)\n+            elif prev_field and prev_field.is_relation and field in prev_field.path_infos[-1].target_fields:\n+                # Check if there are more parts after this one that are actual fields\n+                # (not just lookup transforms like __exact, __isnull, etc.)\n+                has_more_field_parts = False\n+                for j in range(i + 1, len(lookup_parts)):\n+                    try:\n+                        # Try to get the field to see if it's a real field\n+                        temp_model = field.path_infos[-1].to_opts.model if getattr(field, \"path_infos\", None) else model\n+                        temp_model._meta.get_field(lookup_parts[j])\n+                        has_more_field_parts = True\n+                        break\n+                    except FieldDoesNotExist:\n+                        # This part is not a field, continue checking\n+                        continue\n+                \n+                if has_more_field_parts:\n+                    # We need to traverse through this field to access other fields\n+                    relation_parts.append(part)\n             if not getattr(field, \"path_infos\", None):\n                 # This is not a relational field, so further parts\n                 # must be transforms.\n"}