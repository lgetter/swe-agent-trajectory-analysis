{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "pytest-dev__pytest-7490", "model_patch": "diff --git a/src/_pytest/skipping.py b/src/_pytest/skipping.py\nindex 335e10996..185bb4f5c 100644\n--- a/src/_pytest/skipping.py\n+++ b/src/_pytest/skipping.py\n@@ -262,6 +262,10 @@ def pytest_runtest_makereport(item: Item, call: CallInfo[None]):\n     outcome = yield\n     rep = outcome.get_result()\n     xfailed = item._store.get(xfailed_key, None)\n+    # Re-evaluate xfail marks after test call to catch dynamically added markers\n+    if call.when == \"call\" and not item.config.option.runxfail:\n+        xfailed = evaluate_xfail_marks(item)\n+        item._store[xfailed_key] = xfailed\n     # unittest special case, see setting of unexpectedsuccess_key\n     if unexpectedsuccess_key in item._store and rep.when == \"call\":\n         reason = item._store[unexpectedsuccess_key]\ndiff --git a/testing/test_skipping.py b/testing/test_skipping.py\nindex 8fceb37aa..5c7695c0c 100644\n--- a/testing/test_skipping.py\n+++ b/testing/test_skipping.py\n@@ -544,6 +544,26 @@ class TestXFail:\n         result.stdout.fnmatch_lines([\"*1 failed*\" if strict else \"*1 xpassed*\"])\n         assert result.ret == (1 if strict else 0)\n \n+    def test_dynamic_xfail_during_test_call(self, testdir):\n+        \"\"\"Test that dynamically adding xfail marker during test call works correctly.\n+        \n+        This reproduces the issue from pytest 6 where dynamically added xfail markers\n+        in test functions were not being honored.\n+        \"\"\"\n+        testdir.makepyfile(\n+            \"\"\"\n+            import pytest\n+\n+            def test_xfail_test(request):\n+                mark = pytest.mark.xfail(reason=\"xfail\")\n+                request.node.add_marker(mark)\n+                assert 0\n+            \"\"\"\n+        )\n+        result = testdir.runpytest(\"-rsx\")\n+        result.assert_outcomes(xfailed=1)\n+        result.stdout.fnmatch_lines([\"*XFAIL*test_xfail_test*\", \"*xfail*\"])\n+\n \n class TestXFailwithSetupTeardown:\n     def test_failing_setup_issue9(self, testdir):\n"}