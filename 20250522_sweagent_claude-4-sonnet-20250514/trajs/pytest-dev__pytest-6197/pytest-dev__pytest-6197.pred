{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "pytest-dev__pytest-6197", "model_patch": "diff --git a/debug_explicit.py b/debug_explicit.py\nnew file mode 100644\nindex 000000000..cbda45763\n--- /dev/null\n+++ b/debug_explicit.py\n@@ -0,0 +1,40 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Debug script for explicit __init__.py collection\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+\n+def debug_explicit_collection():\n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        print(f\"Working in: {tmpdir}\")\n+        \n+        # Create a test package\n+        pkg_dir = os.path.join(tmpdir, \"testpkg\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_init():\\n    assert True\\n\")\n+        \n+        print(f\"Created {init_file}\")\n+        print(f\"Contents: {open(init_file).read()}\")\n+        \n+        # Run pytest on the specific __init__.py file\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"-s\", \"testpkg/__init__.py\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        print(\"STDOUT:\")\n+        print(result.stdout)\n+        print(\"\\nSTDERR:\")\n+        print(result.stderr)\n+        print(f\"\\nReturn code: {result.returncode}\")\n+\n+if __name__ == \"__main__\":\n+    debug_explicit_collection()\n\\ No newline at end of file\ndiff --git a/debug_explicit_init.py b/debug_explicit_init.py\nnew file mode 100644\nindex 000000000..26f9df867\n--- /dev/null\n+++ b/debug_explicit_init.py\n@@ -0,0 +1,40 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Debug script for explicit __init__.py collection\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+\n+def debug_explicit_init():\n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        print(f\"Working in: {tmpdir}\")\n+        \n+        # Create a test package\n+        pkg_dir = os.path.join(tmpdir, \"test_package\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_package_init():\\n    assert True\\n\")\n+        \n+        print(f\"Created {init_file}\")\n+        print(f\"Contents: {open(init_file).read()}\")\n+        \n+        # Run pytest on the specific __init__.py file\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"-s\", \"test_package/__init__.py\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        print(\"STDOUT:\")\n+        print(result.stdout)\n+        print(\"\\nSTDERR:\")\n+        print(result.stderr)\n+        print(f\"\\nReturn code: {result.returncode}\")\n+\n+if __name__ == \"__main__\":\n+    debug_explicit_init()\n\\ No newline at end of file\ndiff --git a/debug_nontest.py b/debug_nontest.py\nnew file mode 100644\nindex 000000000..25a2e8163\n--- /dev/null\n+++ b/debug_nontest.py\n@@ -0,0 +1,43 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Debug script for nontest collection issue\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+\n+def debug_nontest_collection():\n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        print(f\"Working in: {tmpdir}\")\n+        \n+        # Create a regular test file\n+        test_file = os.path.join(tmpdir, \"test_regular.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_regular():\\n    assert True\\n\")\n+        \n+        # Create a non-test package that should be ignored\n+        nontest_dir = os.path.join(tmpdir, \"nontest\")\n+        os.makedirs(nontest_dir)\n+        nontest_init = os.path.join(nontest_dir, \"__init__.py\")\n+        with open(nontest_init, \"w\") as f:\n+            f.write(\"print('This should not be collected')\\nassert False  # This should not be collected\\n\")\n+        \n+        print(f\"Created {nontest_init}\")\n+        print(f\"Contents: {open(nontest_init).read()}\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"-s\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        print(\"STDOUT:\")\n+        print(result.stdout)\n+        print(\"\\nSTDERR:\")\n+        print(result.stderr)\n+        print(f\"\\nReturn code: {result.returncode}\")\n+\n+if __name__ == \"__main__\":\n+    debug_nontest_collection()\n\\ No newline at end of file\ndiff --git a/debug_test3.py b/debug_test3.py\nnew file mode 100644\nindex 000000000..eb4aa488d\n--- /dev/null\n+++ b/debug_test3.py\n@@ -0,0 +1,47 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Debug script for test 3 (package collection)\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+\n+def debug_test3():\n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        print(f\"Working in: {tmpdir}\")\n+        \n+        # Create a test package\n+        pkg_dir = os.path.join(tmpdir, \"test_package\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_package_init():\\n    assert True\\n\")\n+        \n+        # Create a test module in the package\n+        test_file = os.path.join(pkg_dir, \"test_module.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_module():\\n    assert True\\n\")\n+        \n+        print(f\"Created {init_file}\")\n+        print(f\"Contents: {open(init_file).read()}\")\n+        print(f\"Created {test_file}\")\n+        print(f\"Contents: {open(test_file).read()}\")\n+        \n+        # Run pytest on the package directory\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"-s\", \"test_package/\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        print(\"STDOUT:\")\n+        print(result.stdout)\n+        print(\"\\nSTDERR:\")\n+        print(result.stderr)\n+        print(f\"\\nReturn code: {result.returncode}\")\n+\n+if __name__ == \"__main__\":\n+    debug_test3()\n\\ No newline at end of file\ndiff --git a/reproduce_issue.py b/reproduce_issue.py\nnew file mode 100644\nindex 000000000..666904858\n--- /dev/null\n+++ b/reproduce_issue.py\n@@ -0,0 +1,60 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Script to reproduce the pytest 5.2.3 regression issue where it tries to collect random __init__.py files\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+import shutil\n+\n+def reproduce_issue():\n+    # Create a temporary directory\n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        print(f\"Working in temporary directory: {tmpdir}\")\n+        \n+        # Create the problematic structure\n+        foobar_dir = os.path.join(tmpdir, \"foobar\")\n+        os.makedirs(foobar_dir)\n+        \n+        # Create an __init__.py file that will fail when imported\n+        init_file = os.path.join(foobar_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"assert False\\n\")\n+        \n+        # Create a simple test file\n+        test_file = os.path.join(tmpdir, \"test_foo.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_foo():\\n    assert True\\n\")\n+        \n+        # Change to the temporary directory\n+        original_cwd = os.getcwd()\n+        os.chdir(tmpdir)\n+        \n+        try:\n+            # Run pytest and capture output\n+            result = subprocess.run(\n+                [\"python\", \"-m\", \"pytest\", \"-v\"],\n+                capture_output=True,\n+                text=True,\n+                cwd=tmpdir\n+            )\n+            \n+            print(\"STDOUT:\")\n+            print(result.stdout)\n+            print(\"\\nSTDERR:\")\n+            print(result.stderr)\n+            print(f\"\\nReturn code: {result.returncode}\")\n+            \n+            # Check if the issue is present\n+            if \"ERROR collecting foobar/__init__.py\" in result.stdout or \"AssertionError\" in result.stdout:\n+                print(\"\\n\u274c ISSUE REPRODUCED: pytest is trying to collect foobar/__init__.py\")\n+                return True\n+            else:\n+                print(\"\\n\u2705 No issue found - pytest is not collecting foobar/__init__.py\")\n+                return False\n+                \n+        finally:\n+            os.chdir(original_cwd)\n+\n+if __name__ == \"__main__\":\n+    reproduce_issue()\n\\ No newline at end of file\ndiff --git a/src/_pytest/main.py b/src/_pytest/main.py\nindex 3c205027d..d2839da12 100644\n--- a/src/_pytest/main.py\n+++ b/src/_pytest/main.py\n@@ -529,14 +529,34 @@ class Session(nodes.FSCollector):\n             ):\n                 dirpath = path.dirpath()\n                 if dirpath not in seen_dirs:\n-                    # Collect packages first.\n+                    # Collect packages first, but only if the directory looks like a test package\n+                    # or if the current file would actually be collected\n                     seen_dirs.add(dirpath)\n-                    pkginit = dirpath.join(\"__init__.py\")\n-                    if pkginit.exists():\n-                        for x in self._collectfile(pkginit):\n-                            yield x\n-                            if isinstance(x, Package):\n-                                self._pkg_roots[dirpath] = x\n+                    \n+                    # Check if we should try to collect the package\n+                    should_collect_package = False\n+                    \n+                    # Always collect packages if the current file would be collected\n+                    if path.ext == \".py\":\n+                        from _pytest.python import path_matches_patterns\n+                        python_files = self.config.getini(\"python_files\")\n+                        if path_matches_patterns(path, python_files):\n+                            should_collect_package = True\n+                    \n+                    # Also collect packages if the directory name suggests it's a test package\n+                    if not should_collect_package:\n+                        dirname = dirpath.basename\n+                        if (dirname.startswith(\"test\") and \n+                            (len(dirname) == 4 or dirname[4] in \"_-\")):\n+                            should_collect_package = True\n+                    \n+                    if should_collect_package:\n+                        pkginit = dirpath.join(\"__init__.py\")\n+                        if pkginit.exists():\n+                            for x in self._collectfile(pkginit):\n+                                yield x\n+                                if isinstance(x, Package):\n+                                    self._pkg_roots[dirpath] = x\n                 if dirpath in self._pkg_roots:\n                     # Do not collect packages here.\n                     continue\ndiff --git a/src/_pytest/python.py b/src/_pytest/python.py\nindex 306e5f217..3fce7cf2b 100644\n--- a/src/_pytest/python.py\n+++ b/src/_pytest/python.py\n@@ -177,9 +177,28 @@ def pytest_collect_file(path, parent):\n     ext = path.ext\n     if ext == \".py\":\n         if not parent.session.isinitpath(path):\n-            if not path_matches_patterns(\n-                path, parent.config.getini(\"python_files\") + [\"__init__.py\"]\n-            ):\n+            patterns = parent.config.getini(\"python_files\")\n+            \n+            # For __init__.py files, only add the pattern if certain conditions are met\n+            if path.basename == \"__init__.py\":\n+                from _pytest.python import Package\n+                # Add __init__.py pattern only if:\n+                # 1. The parent is already a Package (being collected as part of package), OR\n+                # 2. The file is in a directory that looks like a test package\n+                if isinstance(parent, Package):\n+                    patterns = patterns + [\"__init__.py\"]\n+                else:\n+                    # Check if the directory name suggests it's a test package\n+                    dirname = path.dirpath().basename\n+                    is_test_dir = (dirname.startswith(\"test\") and \n+                                   (len(dirname) == 4 or dirname[4] in \"_-\"))\n+                    if is_test_dir:\n+                        patterns = patterns + [\"__init__.py\"]\n+            else:\n+                # For non-__init__.py files, always add the __init__.py pattern for compatibility\n+                patterns = patterns + [\"__init__.py\"]\n+            \n+            if not path_matches_patterns(path, patterns):\n                 return\n         ihook = parent.session.gethookproxy(path)\n         return ihook.pytest_pycollect_makemodule(path=path, parent=parent)\n@@ -643,7 +662,7 @@ class Package(Module):\n         this_path = self.fspath.dirpath()\n         init_module = this_path.join(\"__init__.py\")\n         if init_module.check(file=1) and path_matches_patterns(\n-            init_module, self.config.getini(\"python_files\")\n+            init_module, self.config.getini(\"python_files\") + [\"__init__.py\"]\n         ):\n             yield Module(init_module, self)\n         pkg_prefixes = set()\ndiff --git a/test_edge_cases.py b/test_edge_cases.py\nnew file mode 100644\nindex 000000000..915296468\n--- /dev/null\n+++ b/test_edge_cases.py\n@@ -0,0 +1,128 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Test edge cases for the __init__.py collection fix\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+\n+def test_edge_case_1():\n+    \"\"\"Test that directories with 'test' in the middle are not collected\"\"\"\n+    print(\"Edge case 1: Directory with 'test' in the middle\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create a directory with 'test' in the middle\n+        dir_name = \"mytest_package\"\n+        pkg_dir = os.path.join(tmpdir, dir_name)\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file that should NOT be collected\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"assert False  # This should not be collected\\n\")\n+        \n+        # Create a regular test file\n+        test_file = os.path.join(tmpdir, \"test_regular.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_regular():\\n    assert True\\n\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if \"ERROR collecting\" in result.stdout or \"assert False\" in result.stdout:\n+            print(\"\u274c FAILED: pytest collected the __init__.py file\")\n+            return False\n+        else:\n+            print(\"\u2705 PASSED: pytest did not collect the __init__.py file\")\n+            return True\n+\n+def test_edge_case_2():\n+    \"\"\"Test that 'test' directory works\"\"\"\n+    print(\"\\nEdge case 2: Directory named exactly 'test'\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create a directory named exactly 'test'\n+        pkg_dir = os.path.join(tmpdir, \"test\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_in_test_dir():\\n    assert True\\n\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if \"test_in_test_dir PASSED\" in result.stdout and result.returncode == 0:\n+            print(\"\u2705 PASSED: 'test' directory works\")\n+            return True\n+        else:\n+            print(\"\u274c FAILED: 'test' directory doesn't work\")\n+            print(\"STDOUT:\", result.stdout)\n+            return False\n+\n+def test_edge_case_3():\n+    \"\"\"Test that 'test-package' directory works\"\"\"\n+    print(\"\\nEdge case 3: Directory named 'test-package'\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create a directory named 'test-package'\n+        pkg_dir = os.path.join(tmpdir, \"test-package\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_in_test_dash_package():\\n    assert True\\n\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if \"test_in_test_dash_package PASSED\" in result.stdout and result.returncode == 0:\n+            print(\"\u2705 PASSED: 'test-package' directory works\")\n+            return True\n+        else:\n+            print(\"\u274c FAILED: 'test-package' directory doesn't work\")\n+            print(\"STDOUT:\", result.stdout)\n+            return False\n+\n+def main():\n+    print(\"Testing edge cases for __init__.py collection fix...\")\n+    \n+    tests = [\n+        test_edge_case_1,\n+        test_edge_case_2,\n+        test_edge_case_3,\n+    ]\n+    \n+    results = []\n+    for test in tests:\n+        results.append(test())\n+    \n+    print(f\"\\n{'='*60}\")\n+    print(f\"Edge Case Results: {sum(results)}/{len(results)} passed\")\n+    \n+    if all(results):\n+        print(\"\ud83c\udf89 All edge case tests passed!\")\n+        return True\n+    else:\n+        print(\"\u274c Some edge case tests failed.\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    main()\n\\ No newline at end of file\ndiff --git a/test_fix.py b/test_fix.py\nnew file mode 100644\nindex 000000000..efb5220fc\n--- /dev/null\n+++ b/test_fix.py\n@@ -0,0 +1,195 @@\n+#!/usr/bin/env python3\n+\"\"\"\n+Test script to verify that our fix works correctly and doesn't break legitimate use cases\n+\"\"\"\n+import os\n+import subprocess\n+import tempfile\n+import shutil\n+\n+def test_case_1_regression_fix():\n+    \"\"\"Test that the regression is fixed - random __init__.py files are not collected\"\"\"\n+    print(\"Test 1: Regression fix - random __init__.py files should not be collected\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create the problematic structure\n+        foobar_dir = os.path.join(tmpdir, \"foobar\")\n+        os.makedirs(foobar_dir)\n+        \n+        # Create an __init__.py file that will fail when imported\n+        init_file = os.path.join(foobar_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"assert False\\n\")\n+        \n+        # Create a simple test file\n+        test_file = os.path.join(tmpdir, \"test_foo.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_foo():\\n    assert True\\n\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if \"ERROR collecting foobar/__init__.py\" in result.stdout or \"AssertionError\" in result.stdout:\n+            print(\"\u274c FAILED: pytest is still collecting foobar/__init__.py\")\n+            return False\n+        else:\n+            print(\"\u2705 PASSED: pytest is not collecting foobar/__init__.py\")\n+            return True\n+\n+def test_case_2_explicit_init_collection():\n+    \"\"\"Test that __init__.py files can still be collected when explicitly requested\"\"\"\n+    print(\"\\nTest 2: Explicit __init__.py collection should still work\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create a test package\n+        pkg_dir = os.path.join(tmpdir, \"testpkg\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_init():\\n    assert True\\n\")\n+        \n+        # Run pytest on the specific __init__.py file\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"testpkg/__init__.py\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if \"test_init PASSED\" in result.stdout and result.returncode == 0:\n+            print(\"\u2705 PASSED: explicit __init__.py collection works\")\n+            return True\n+        else:\n+            print(\"\u274c FAILED: explicit __init__.py collection doesn't work\")\n+            print(\"STDOUT:\", result.stdout)\n+            print(\"STDERR:\", result.stderr)\n+            return False\n+\n+def test_case_3_package_collection():\n+    \"\"\"Test that __init__.py files in test packages are still collected\"\"\"\n+    print(\"\\nTest 3: Package collection should still work\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create a test package\n+        pkg_dir = os.path.join(tmpdir, \"test_package\")\n+        os.makedirs(pkg_dir)\n+        \n+        # Create an __init__.py file with a test\n+        init_file = os.path.join(pkg_dir, \"__init__.py\")\n+        with open(init_file, \"w\") as f:\n+            f.write(\"def test_package_init():\\n    assert True\\n\")\n+        \n+        # Create a test module in the package\n+        test_file = os.path.join(pkg_dir, \"test_module.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_module():\\n    assert True\\n\")\n+        \n+        # Run pytest on the package directory\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\", \"test_package/\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        if (\"test_package_init PASSED\" in result.stdout and \n+            \"test_module PASSED\" in result.stdout and \n+            result.returncode == 0):\n+            print(\"\u2705 PASSED: package collection works\")\n+            return True\n+        else:\n+            print(\"\u274c FAILED: package collection doesn't work\")\n+            print(\"STDOUT:\", result.stdout)\n+            print(\"STDERR:\", result.stderr)\n+            return False\n+\n+def test_case_4_nested_packages():\n+    \"\"\"Test that nested packages work correctly\"\"\"\n+    print(\"\\nTest 4: Nested packages should work correctly\")\n+    \n+    with tempfile.TemporaryDirectory() as tmpdir:\n+        # Create nested test packages\n+        pkg1_dir = os.path.join(tmpdir, \"test_pkg1\")\n+        pkg2_dir = os.path.join(pkg1_dir, \"test_pkg2\")\n+        os.makedirs(pkg2_dir)\n+        \n+        # Create __init__.py files\n+        init1_file = os.path.join(pkg1_dir, \"__init__.py\")\n+        with open(init1_file, \"w\") as f:\n+            f.write(\"def test_pkg1():\\n    assert True\\n\")\n+        \n+        init2_file = os.path.join(pkg2_dir, \"__init__.py\")\n+        with open(init2_file, \"w\") as f:\n+            f.write(\"def test_pkg2():\\n    assert True\\n\")\n+        \n+        # Create a regular test file\n+        test_file = os.path.join(tmpdir, \"test_regular.py\")\n+        with open(test_file, \"w\") as f:\n+            f.write(\"def test_regular():\\n    assert True\\n\")\n+        \n+        # Create a non-test package that should be ignored\n+        nontest_dir = os.path.join(tmpdir, \"nontest\")\n+        os.makedirs(nontest_dir)\n+        nontest_init = os.path.join(nontest_dir, \"__init__.py\")\n+        with open(nontest_init, \"w\") as f:\n+            f.write(\"assert False  # This should not be collected\\n\")\n+        \n+        # Run pytest\n+        result = subprocess.run(\n+            [\"python\", \"-m\", \"pytest\", \"-v\"],\n+            capture_output=True,\n+            text=True,\n+            cwd=tmpdir\n+        )\n+        \n+        success = (\n+            \"test_pkg1 PASSED\" in result.stdout and\n+            \"test_pkg2 PASSED\" in result.stdout and\n+            \"test_regular PASSED\" in result.stdout and\n+            \"ERROR collecting nontest/__init__.py\" not in result.stdout and\n+            \"assert False\" not in result.stdout and\n+            result.returncode == 0\n+        )\n+        \n+        if success:\n+            print(\"\u2705 PASSED: nested packages work correctly\")\n+            return True\n+        else:\n+            print(\"\u274c FAILED: nested packages don't work correctly\")\n+            print(\"STDOUT:\", result.stdout)\n+            print(\"STDERR:\", result.stderr)\n+            return False\n+\n+def main():\n+    print(\"Testing pytest fix for __init__.py collection regression...\")\n+    \n+    tests = [\n+        test_case_1_regression_fix,\n+        test_case_2_explicit_init_collection,\n+        test_case_3_package_collection,\n+        test_case_4_nested_packages,\n+    ]\n+    \n+    results = []\n+    for test in tests:\n+        results.append(test())\n+    \n+    print(f\"\\n{'='*60}\")\n+    print(f\"Test Results: {sum(results)}/{len(results)} passed\")\n+    \n+    if all(results):\n+        print(\"\ud83c\udf89 All tests passed! The fix works correctly.\")\n+        return True\n+    else:\n+        print(\"\u274c Some tests failed. The fix needs more work.\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    main()\n\\ No newline at end of file\n"}