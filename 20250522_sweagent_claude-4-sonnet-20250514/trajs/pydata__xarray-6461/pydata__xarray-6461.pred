{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "pydata__xarray-6461", "model_patch": "diff --git a/xarray/core/computation.py b/xarray/core/computation.py\nindex 7676d8e5..589f29c2 100644\n--- a/xarray/core/computation.py\n+++ b/xarray/core/computation.py\n@@ -1829,7 +1829,38 @@ def where(cond, x, y, keep_attrs=None):\n     if keep_attrs is True:\n         # keep the attributes of x, the second parameter, by default to\n         # be consistent with the `where` method of `DataArray` and `Dataset`\n-        keep_attrs = lambda attrs, context: attrs[1]\n+        if hasattr(x, 'attrs'):\n+            # x has attributes, so we want to preserve them\n+            # We need to find x's attributes in the attrs list passed to merge_attrs\n+            # The attrs list contains attributes from all Variable/DataArray arguments\n+            # in the order they appear: [cond.attrs, x.attrs, y.attrs] (if all have attrs)\n+            # But if some are scalars, they won't appear in the list\n+            \n+            # Create a mapping from the original arguments to their position in attrs list\n+            args_with_attrs = []\n+            if hasattr(cond, 'attrs'):\n+                args_with_attrs.append(cond)\n+            if hasattr(x, 'attrs'):\n+                args_with_attrs.append(x)\n+            if hasattr(y, 'attrs'):\n+                args_with_attrs.append(y)\n+            \n+            # Find x's position using identity comparison (not equality)\n+            x_index = None\n+            for i, arg in enumerate(args_with_attrs):\n+                if arg is x:\n+                    x_index = i\n+                    break\n+            \n+            if x_index is not None:\n+                # Capture x_index by value to avoid closure issues\n+                keep_attrs = lambda attrs, context, idx=x_index: attrs[idx] if idx < len(attrs) else {}\n+            else:\n+                # This shouldn't happen since we checked hasattr(x, 'attrs') above\n+                keep_attrs = lambda attrs, context: {}\n+        else:\n+            # x doesn't have attributes (it's a scalar), so return empty dict\n+            keep_attrs = lambda attrs, context: {}\n \n     # alignment for three arguments is complicated, so don't support it yet\n     return apply_ufunc(\n"}