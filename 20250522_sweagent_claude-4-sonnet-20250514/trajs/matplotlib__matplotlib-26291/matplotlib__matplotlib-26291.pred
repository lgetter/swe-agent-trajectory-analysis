{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "matplotlib__matplotlib-26291", "model_patch": "diff --git a/lib/matplotlib/axes/_base.py b/lib/matplotlib/axes/_base.py\nindex d393cf209c..56a38aae40 100644\n--- a/lib/matplotlib/axes/_base.py\n+++ b/lib/matplotlib/axes/_base.py\n@@ -834,6 +834,11 @@ class _AxesBase(martist.Artist):\n             mtransforms.IdentityTransform())\n \n         self._set_lim_and_transforms()\n+        \n+        # Set the figure on the axes locator if it exists and has a set_figure method\n+        if (hasattr(self, '_axes_locator') and self._axes_locator is not None and \n+            hasattr(self._axes_locator, 'set_figure')):\n+            self._axes_locator.set_figure(fig)\n \n     def _unstale_viewLim(self):\n         # We should arrange to store this information once per share-group\n@@ -1165,6 +1170,9 @@ class _AxesBase(martist.Artist):\n         locator : Callable[[Axes, Renderer], Bbox]\n         \"\"\"\n         self._axes_locator = locator\n+        # Set the figure on the locator if it has a set_figure method\n+        if locator is not None and hasattr(locator, 'set_figure'):\n+            locator.set_figure(self.figure)\n         self.stale = True\n \n     def get_axes_locator(self):\ndiff --git a/lib/matplotlib/offsetbox.py b/lib/matplotlib/offsetbox.py\nindex 13af941552..6d21edbd55 100644\n--- a/lib/matplotlib/offsetbox.py\n+++ b/lib/matplotlib/offsetbox.py\n@@ -234,7 +234,8 @@ class OffsetBox(martist.Artist):\n         \"\"\"\n         super().set_figure(fig)\n         for c in self.get_children():\n-            c.set_figure(fig)\n+            if c is not None:\n+                c.set_figure(fig)\n \n     @martist.Artist.axes.setter\n     def axes(self, ax):\n@@ -1053,6 +1054,8 @@ class AnchoredOffsetbox(OffsetBox):\n     @_compat_get_offset\n     def get_offset(self, bbox, renderer):\n         # docstring inherited\n+        if renderer is None:\n+            renderer = self.figure._get_renderer()\n         pad = (self.borderpad\n                * renderer.points_to_pixels(self.prop.get_size_in_points()))\n         bbox_to_anchor = self.get_bbox_to_anchor()\n"}