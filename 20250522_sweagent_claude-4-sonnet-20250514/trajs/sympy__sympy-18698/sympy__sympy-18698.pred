{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "sympy__sympy-18698", "model_patch": "diff --git a/sympy/polys/polytools.py b/sympy/polys/polytools.py\nindex c9e77a901f..b614d7bb7f 100644\n--- a/sympy/polys/polytools.py\n+++ b/sympy/polys/polytools.py\n@@ -5895,6 +5895,53 @@ def _factors_product(factors):\n     return Mul(*[f.as_expr()**k for f, k in factors])\n \n \n+def _combine_factors_by_multiplicity(factors, method):\n+    \"\"\"Combine factors with the same multiplicity for square-free factorization.\"\"\"\n+    if method != 'sqf':\n+        return factors\n+    \n+    from collections import defaultdict\n+    \n+    # Group factors by multiplicity\n+    multiplicity_groups = defaultdict(list)\n+    for factor, mult in factors:\n+        multiplicity_groups[mult].append(factor)\n+    \n+    # Combine factors within each multiplicity group\n+    combined_factors = []\n+    for mult, factor_list in multiplicity_groups.items():\n+        if len(factor_list) == 1:\n+            combined_factors.append((factor_list[0], mult))\n+        else:\n+            # Only combine factors if they are all univariate polynomials\n+            # and have the same variable set\n+            should_combine = True\n+            first_gens = factor_list[0].gens if hasattr(factor_list[0], 'gens') else None\n+            \n+            for factor in factor_list:\n+                if hasattr(factor, 'gens'):\n+                    # Check if all factors have the same generators and are univariate\n+                    if len(factor.gens) != 1 or factor.gens != first_gens:\n+                        should_combine = False\n+                        break\n+                else:\n+                    should_combine = False\n+                    break\n+            \n+            if should_combine and first_gens and len(first_gens) == 1:\n+                # Multiply all factors with the same multiplicity\n+                combined_poly = factor_list[0]\n+                for factor in factor_list[1:]:\n+                    combined_poly = combined_poly * factor\n+                combined_factors.append((combined_poly, mult))\n+            else:\n+                # Don't combine, keep factors separate\n+                for factor in factor_list:\n+                    combined_factors.append((factor, mult))\n+    \n+    return combined_factors\n+\n+\n def _symbolic_factor_list(expr, opt, method):\n     \"\"\"Helper function for :func:`_symbolic_factor`. \"\"\"\n     coeff, factors = S.One, []\n@@ -5995,6 +6042,10 @@ def _generic_factor_list(expr, gens, args, method):\n                     f, _ = _poly_from_expr(f, _opt)\n                     factors[i] = (f, k)\n \n+        # Combine factors with the same multiplicity for square-free factorization\n+        fp = _combine_factors_by_multiplicity(fp, method)\n+        fq = _combine_factors_by_multiplicity(fq, method)\n+\n         fp = _sorted_factors(fp, method)\n         fq = _sorted_factors(fq, method)\n \n"}