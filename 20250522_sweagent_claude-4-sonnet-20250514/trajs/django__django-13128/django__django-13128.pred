{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-13128", "model_patch": "diff --git a/django/db/models/expressions.py b/django/db/models/expressions.py\nindex d913658291..5ea9367c64 100644\n--- a/django/db/models/expressions.py\n+++ b/django/db/models/expressions.py\n@@ -473,6 +473,34 @@ class CombinedExpression(SQLiteNumericMixin, Expression):\n         sql = connection.ops.combine_expression(self.connector, expressions)\n         return expression_wrapper % sql, expression_params\n \n+    def _resolve_output_field(self):\n+        try:\n+            lhs_type = self.lhs.output_field.get_internal_type()\n+        except FieldError:\n+            lhs_type = None\n+        try:\n+            rhs_type = self.rhs.output_field.get_internal_type()\n+        except FieldError:\n+            rhs_type = None\n+        \n+        # Handle temporal subtraction: datetime - datetime = duration\n+        datetime_fields = {'DateField', 'DateTimeField', 'TimeField'}\n+        if self.connector == self.SUB and lhs_type in datetime_fields and lhs_type == rhs_type:\n+            return fields.DurationField()\n+        \n+        # Handle duration arithmetic: duration +/- duration = duration, datetime +/- duration = datetime\n+        if lhs_type == 'DurationField' or rhs_type == 'DurationField':\n+            if self.connector in (self.ADD, self.SUB):\n+                if lhs_type == 'DurationField' and rhs_type == 'DurationField':\n+                    return fields.DurationField()\n+                elif lhs_type in datetime_fields and rhs_type == 'DurationField':\n+                    return self.lhs.output_field\n+                elif lhs_type == 'DurationField' and rhs_type in datetime_fields:\n+                    return self.rhs.output_field\n+        \n+        # Fall back to the default behavior\n+        return super()._resolve_output_field()\n+\n     def resolve_expression(self, query=None, allow_joins=True, reuse=None, summarize=False, for_save=False):\n         c = self.copy()\n         c.is_summary = summarize\n"}