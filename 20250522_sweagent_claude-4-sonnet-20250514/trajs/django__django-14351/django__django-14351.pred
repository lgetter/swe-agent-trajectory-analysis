{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-14351", "model_patch": "diff --git a/django/db/models/sql/query.py b/django/db/models/sql/query.py\nindex 6629a1fd51..e26e5eec4d 100644\n--- a/django/db/models/sql/query.py\n+++ b/django/db/models/sql/query.py\n@@ -2328,6 +2328,32 @@ class Query(BaseExpression):\n             field.empty_strings_allowed\n         ) or field.null\n \n+    def get_group_by_cols(self, alias=None):\n+        \"\"\"\n+        Return the columns that should be used for GROUP BY when this Query\n+        is used as an expression.\n+        \n+        If this Query has explicit select fields, use those. Otherwise, if\n+        this Query is being used as a subquery (e.g., in an IN lookup), try\n+        to optimize by selecting only the primary key field.\n+        \"\"\"\n+        if self.has_select_fields:\n+            # If the query has explicit select fields, use the default behavior\n+            return super().get_group_by_cols(alias)\n+        \n+        # If this query doesn't have explicit select fields and is being used\n+        # as a subquery, try to optimize by selecting only the primary key\n+        if self.subquery and self.model:\n+            # Create a clone and optimize it to select only the primary key\n+            clone = self.clone()\n+            clone.clear_select_clause()\n+            pk_field = self.model._meta.pk\n+            clone.add_fields([pk_field.name], True)\n+            return clone.get_group_by_cols(alias)\n+        \n+        # Fall back to the default behavior\n+        return super().get_group_by_cols(alias)\n+\n \n def get_order_dir(field, default='ASC'):\n     \"\"\"\n"}