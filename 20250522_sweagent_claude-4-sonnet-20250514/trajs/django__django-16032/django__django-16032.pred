{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-16032", "model_patch": "diff --git a/django/db/models/lookups.py b/django/db/models/lookups.py\nindex 866e38df83..c3e170a3b3 100644\n--- a/django/db/models/lookups.py\n+++ b/django/db/models/lookups.py\n@@ -420,7 +420,10 @@ class In(FieldGetDbPrepValueIterableMixin, BuiltinLookup):\n \n         if isinstance(self.rhs, Query):\n             self.rhs.clear_ordering(clear_default=True)\n-            if not self.rhs.has_select_fields:\n+            # Only preserve explicit field selections (from values/values_list),\n+            # not just annotations or aliases. Use default_cols to detect if\n+            # the query has explicit field selections.\n+            if self.rhs.default_cols:\n                 self.rhs.clear_select_clause()\n                 self.rhs.add_fields([\"pk\"])\n         return super().get_prep_lookup()\n"}