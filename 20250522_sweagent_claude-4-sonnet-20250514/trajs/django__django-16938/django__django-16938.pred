{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-16938", "model_patch": "diff --git a/django/core/serializers/python.py b/django/core/serializers/python.py\nindex 36048601af..fa7c7a9834 100644\n--- a/django/core/serializers/python.py\n+++ b/django/core/serializers/python.py\n@@ -79,7 +79,26 @@ class Serializer(base.Serializer):\n                     return self._value_from_field(value, value._meta.pk)\n \n                 def queryset_iterator(obj, field):\n-                    return getattr(obj, field.name).only(\"pk\").iterator()\n+                    manager = getattr(obj, field.name)\n+                    queryset = manager.all()\n+                    # Build the only() fields list - include pk and any select_related fields\n+                    # to avoid conflicts between deferred loading and select_related\n+                    only_fields = [\"pk\"]\n+                    if queryset.query.select_related:\n+                        # select_related can be True (select all) or a dict of field names\n+                        if isinstance(queryset.query.select_related, dict):\n+                            for field_name in queryset.query.select_related.keys():\n+                                only_fields.append(field_name)\n+                        # If select_related is True, we can't use only() as it would conflict\n+                        # with the automatic selection of all related fields\n+                        elif queryset.query.select_related is True:\n+                            return queryset.iterator()\n+                    \n+                    # Check if prefetch_related is used, which requires chunk_size for iterator()\n+                    if queryset._prefetch_related_lookups:\n+                        return queryset.only(*only_fields).iterator(chunk_size=2000)\n+                    else:\n+                        return queryset.only(*only_fields).iterator()\n \n             m2m_iter = getattr(obj, \"_prefetched_objects_cache\", {}).get(\n                 field.name,\n"}