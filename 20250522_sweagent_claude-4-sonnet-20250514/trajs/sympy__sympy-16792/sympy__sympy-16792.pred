{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "sympy__sympy-16792", "model_patch": "diff --git a/sympy/utilities/codegen.py b/sympy/utilities/codegen.py\nindex f0befb2bd7..ab3e65f3af 100644\n--- a/sympy/utilities/codegen.py\n+++ b/sympy/utilities/codegen.py\n@@ -700,14 +700,25 @@ def routine(self, name, expr, argument_sequence=None, global_vars=None):\n             array_symbols[array.base.label] = array\n         for array in expressions.atoms(MatrixSymbol) | local_expressions.atoms(MatrixSymbol):\n             array_symbols[array] = array\n+        \n+        # Also include array symbols from argument_sequence that might not appear in expressions\n+        if argument_sequence is not None:\n+            for arg in argument_sequence:\n+                if isinstance(arg, MatrixSymbol):\n+                    array_symbols[arg] = arg\n+                elif isinstance(arg, IndexedBase):\n+                    array_symbols[arg.label] = arg\n \n         for symbol in sorted(symbols, key=str):\n             if symbol in array_symbols:\n-                dims = []\n                 array = array_symbols[symbol]\n-                for dim in array.shape:\n-                    dims.append((S.Zero, dim - 1))\n-                metadata = {'dimensions': dims}\n+                if hasattr(array, 'shape') and array.shape is not None:\n+                    dims = []\n+                    for dim in array.shape:\n+                        dims.append((S.Zero, dim - 1))\n+                    metadata = {'dimensions': dims}\n+                else:\n+                    metadata = {}\n             else:\n                 metadata = {}\n \n@@ -739,7 +750,19 @@ def routine(self, name, expr, argument_sequence=None, global_vars=None):\n                 try:\n                     new_args.append(name_arg_dict[symbol])\n                 except KeyError:\n-                    new_args.append(InputArgument(symbol))\n+                    # Check if this symbol is a MatrixSymbol or IndexedBase that needs dimensions\n+                    if symbol in array_symbols:\n+                        array = array_symbols[symbol]\n+                        if hasattr(array, 'shape') and array.shape is not None:\n+                            dims = []\n+                            for dim in array.shape:\n+                                dims.append((S.Zero, dim - 1))\n+                            metadata = {'dimensions': dims}\n+                        else:\n+                            metadata = {}\n+                    else:\n+                        metadata = {}\n+                    new_args.append(InputArgument(symbol, **metadata))\n             arg_list = new_args\n \n         return Routine(name, arg_list, return_val, local_vars, global_vars)\n"}