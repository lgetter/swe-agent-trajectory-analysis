{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "pydata__xarray-6599", "model_patch": "diff --git a/xarray/core/computation.py b/xarray/core/computation.py\nindex 823cbe02..4eb147c4 100644\n--- a/xarray/core/computation.py\n+++ b/xarray/core/computation.py\n@@ -1905,6 +1905,17 @@ def polyval(\n     coeffs = coeffs.reindex(\n         {degree_dim: np.arange(max_deg + 1)}, fill_value=0, copy=False\n     )\n+    \n+    # Handle the case where coord is a DataArray with datetime64 data but has\n+    # a coordinate with the same name that contains timedelta64 data\n+    from .dataarray import DataArray\n+    if (isinstance(coord, DataArray) and \n+        coord.name in coord.coords and \n+        coord.dtype.kind == \"M\" and  # datetime64\n+        coord.coords[coord.name].dtype.kind == \"m\"):  # timedelta64\n+        # Use the coordinate values instead of the data values\n+        coord = coord.coords[coord.name]\n+    \n     coord = _ensure_numeric(coord)  # type: ignore # https://github.com/python/mypy/issues/1533 ?\n \n     # using Horner's method\n@@ -1934,10 +1945,15 @@ def _ensure_numeric(data: T_Xarray) -> T_Xarray:\n \n     def to_floatable(x: DataArray) -> DataArray:\n         if x.dtype.kind in \"mM\":\n+            # For timedelta64, don't use a datetime offset\n+            if x.dtype.kind == \"m\":\n+                offset = None  # Use minimum value as offset for timedelta64\n+            else:\n+                offset = np.datetime64(\"1970-01-01\")  # Use epoch for datetime64\n             return x.copy(\n                 data=datetime_to_numeric(\n                     x.data,\n-                    offset=np.datetime64(\"1970-01-01\"),\n+                    offset=offset,\n                     datetime_unit=\"ns\",\n                 ),\n             )\n"}