{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-15741", "model_patch": "diff --git a/django/utils/formats.py b/django/utils/formats.py\nindex 3f38322d84..fa90231205 100644\n--- a/django/utils/formats.py\n+++ b/django/utils/formats.py\n@@ -106,6 +106,9 @@ def get_format(format_type, lang=None, use_l10n=None):\n     If use_l10n is provided and is not None, it forces the value to\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n+    # Convert format_type to string to handle lazy strings\n+    format_type_str = str(format_type)\n+    \n     if use_l10n is None:\n         try:\n             use_l10n = settings._USE_L10N_INTERNAL\n@@ -125,13 +128,13 @@ def get_format(format_type, lang=None, use_l10n=None):\n     val = None\n     if use_l10n:\n         for module in get_format_modules(lang):\n-            val = getattr(module, format_type, None)\n+            val = getattr(module, format_type_str, None)\n             if val is not None:\n                 break\n     if val is None:\n         if format_type not in FORMAT_SETTINGS:\n             return format_type\n-        val = getattr(settings, format_type)\n+        val = getattr(settings, format_type_str)\n     elif format_type in ISO_INPUT_FORMATS:\n         # If a list of input formats from one of the format_modules was\n         # retrieved, make sure the ISO_INPUT_FORMATS are in this list.\ndiff --git a/reproduce_error.py b/reproduce_error.py\nnew file mode 100644\nindex 0000000000..48a3f55548\n--- /dev/null\n+++ b/reproduce_error.py\n@@ -0,0 +1,93 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Script to reproduce the error with lazy strings in get_format.\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+    )\n+\n+django.setup()\n+\n+from datetime import datetime\n+from django.utils.translation import gettext_lazy as _\n+from django.utils import formats\n+from django.template.defaultfilters import date\n+\n+def test_lazy_format():\n+    \"\"\"Test that demonstrates the issue with lazy strings in get_format.\"\"\"\n+    print(\"Testing lazy string format...\")\n+    \n+    # Create a lazy string like what would be used in templates\n+    lazy_format = _('Y-m-d')\n+    print(f\"Lazy format: {lazy_format}\")\n+    print(f\"Type of lazy format: {type(lazy_format)}\")\n+    \n+    # Create a test date\n+    test_date = datetime(2023, 12, 25)\n+    print(f\"Test date: {test_date}\")\n+    \n+    try:\n+        # This should fail with the current implementation\n+        result = date(test_date, lazy_format)\n+        print(f\"Success! Result: {result}\")\n+    except Exception as e:\n+        print(f\"Error: {type(e).__name__}: {e}\")\n+        return False\n+    \n+    return True\n+\n+def test_regular_format():\n+    \"\"\"Test that regular strings work fine.\"\"\"\n+    print(\"\\nTesting regular string format...\")\n+    \n+    # Create a regular string\n+    regular_format = 'Y-m-d'\n+    print(f\"Regular format: {regular_format}\")\n+    print(f\"Type of regular format: {type(regular_format)}\")\n+    \n+    # Create a test date\n+    test_date = datetime(2023, 12, 25)\n+    print(f\"Test date: {test_date}\")\n+    \n+    try:\n+        result = date(test_date, regular_format)\n+        print(f\"Success! Result: {result}\")\n+        return True\n+    except Exception as e:\n+        print(f\"Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    print(\"Reproducing the lazy string format error...\")\n+    \n+    # Test regular format first to make sure basic functionality works\n+    regular_works = test_regular_format()\n+    \n+    # Test lazy format to reproduce the error\n+    lazy_works = test_lazy_format()\n+    \n+    print(f\"\\nResults:\")\n+    print(f\"Regular format works: {regular_works}\")\n+    print(f\"Lazy format works: {lazy_works}\")\n+    \n+    if not lazy_works:\n+        print(\"\\nError reproduced successfully!\")\n+        sys.exit(1)\n+    else:\n+        print(\"\\nNo error found - issue may be fixed!\")\n+        sys.exit(0)\n\\ No newline at end of file\ndiff --git a/test_comprehensive.py b/test_comprehensive.py\nnew file mode 100644\nindex 0000000000..75896be725\n--- /dev/null\n+++ b/test_comprehensive.py\n@@ -0,0 +1,175 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Comprehensive test for the lazy string fix in get_format.\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+    )\n+\n+django.setup()\n+\n+from datetime import datetime\n+from django.utils.translation import gettext_lazy as _\n+from django.utils import formats\n+from django.template.defaultfilters import date, time\n+\n+def test_date_filter_with_lazy_format():\n+    \"\"\"Test the date filter with lazy format strings.\"\"\"\n+    print(\"Testing date filter with lazy format strings...\")\n+    \n+    test_date = datetime(2023, 12, 25, 14, 30, 45)\n+    \n+    # Test various lazy format strings\n+    test_cases = [\n+        (_('Y-m-d'), '2023-12-25'),\n+        (_('d/m/Y'), '25/12/2023'),\n+        (_('F j, Y'), 'December 25, 2023'),\n+        (_('Y-m-d H:i:s'), '2023-12-25 14:30:45'),\n+    ]\n+    \n+    all_passed = True\n+    for lazy_format, expected in test_cases:\n+        try:\n+            result = date(test_date, lazy_format)\n+            print(f\"  Format: {lazy_format} -> Result: {result}\")\n+            if result != expected:\n+                print(f\"    ERROR: Expected {expected}, got {result}\")\n+                all_passed = False\n+        except Exception as e:\n+            print(f\"  Format: {lazy_format} -> ERROR: {type(e).__name__}: {e}\")\n+            all_passed = False\n+    \n+    return all_passed\n+\n+def test_time_filter_with_lazy_format():\n+    \"\"\"Test the time filter with lazy format strings.\"\"\"\n+    print(\"\\nTesting time filter with lazy format strings...\")\n+    \n+    test_time = datetime(2023, 12, 25, 14, 30, 45)\n+    \n+    # Test various lazy format strings\n+    test_cases = [\n+        (_('H:i'), '14:30'),\n+        (_('H:i:s'), '14:30:45'),\n+        (_('g:i A'), '2:30 PM'),\n+    ]\n+    \n+    all_passed = True\n+    for lazy_format, expected in test_cases:\n+        try:\n+            result = time(test_time, lazy_format)\n+            print(f\"  Format: {lazy_format} -> Result: {result}\")\n+            if result != expected:\n+                print(f\"    ERROR: Expected {expected}, got {result}\")\n+                all_passed = False\n+        except Exception as e:\n+            print(f\"  Format: {lazy_format} -> ERROR: {type(e).__name__}: {e}\")\n+            all_passed = False\n+    \n+    return all_passed\n+\n+def test_get_format_directly():\n+    \"\"\"Test get_format function directly with lazy strings.\"\"\"\n+    print(\"\\nTesting get_format function directly...\")\n+    \n+    # Test with known format settings\n+    test_cases = [\n+        _('DATE_FORMAT'),\n+        _('TIME_FORMAT'),\n+        _('DATETIME_FORMAT'),\n+    ]\n+    \n+    all_passed = True\n+    for lazy_format in test_cases:\n+        try:\n+            result = formats.get_format(lazy_format)\n+            print(f\"  Format: {lazy_format} -> Result: {result}\")\n+        except Exception as e:\n+            print(f\"  Format: {lazy_format} -> ERROR: {type(e).__name__}: {e}\")\n+            all_passed = False\n+    \n+    return all_passed\n+\n+def test_get_format_with_custom_format():\n+    \"\"\"Test get_format with custom format strings (not in FORMAT_SETTINGS).\"\"\"\n+    print(\"\\nTesting get_format with custom format strings...\")\n+    \n+    # Test with custom format strings that are not in FORMAT_SETTINGS\n+    test_cases = [\n+        _('Y-m-d'),\n+        _('H:i:s'),\n+        _('custom-format'),\n+    ]\n+    \n+    all_passed = True\n+    for lazy_format in test_cases:\n+        try:\n+            result = formats.get_format(lazy_format)\n+            print(f\"  Format: {lazy_format} -> Result: {result}\")\n+            # For custom formats, get_format should return the format itself\n+            if str(result) != str(lazy_format):\n+                print(f\"    ERROR: Expected {lazy_format}, got {result}\")\n+                all_passed = False\n+        except Exception as e:\n+            print(f\"  Format: {lazy_format} -> ERROR: {type(e).__name__}: {e}\")\n+            all_passed = False\n+    \n+    return all_passed\n+\n+def test_caching_behavior():\n+    \"\"\"Test that caching works correctly with lazy strings.\"\"\"\n+    print(\"\\nTesting caching behavior...\")\n+    \n+    lazy_format = _('Y-m-d')\n+    \n+    # Call get_format twice to test caching\n+    try:\n+        result1 = formats.get_format(lazy_format)\n+        result2 = formats.get_format(lazy_format)\n+        \n+        print(f\"  First call: {result1}\")\n+        print(f\"  Second call: {result2}\")\n+        \n+        if result1 == result2:\n+            print(\"  Caching works correctly!\")\n+            return True\n+        else:\n+            print(\"  ERROR: Caching not working correctly\")\n+            return False\n+    except Exception as e:\n+        print(f\"  ERROR: {type(e).__name__}: {e}\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    print(\"Running comprehensive tests for lazy string support in get_format...\")\n+    \n+    tests = [\n+        test_date_filter_with_lazy_format,\n+        test_time_filter_with_lazy_format,\n+        test_get_format_directly,\n+        test_get_format_with_custom_format,\n+        test_caching_behavior,\n+    ]\n+    \n+    all_passed = True\n+    for test in tests:\n+        if not test():\n+            all_passed = False\n+    \n+    print(f\"\\nOverall result: {'PASS' if all_passed else 'FAIL'}\")\n+    sys.exit(0 if all_passed else 1)\n\\ No newline at end of file\ndiff --git a/test_edge_cases.py b/test_edge_cases.py\nnew file mode 100644\nindex 0000000000..745cfc2512\n--- /dev/null\n+++ b/test_edge_cases.py\n@@ -0,0 +1,147 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Test edge cases for the lazy string fix in get_format.\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+    )\n+\n+django.setup()\n+\n+from django.utils import formats\n+from django.utils.translation import gettext_lazy as _\n+from django.utils.functional import lazy\n+\n+def test_empty_lazy_string():\n+    \"\"\"Test get_format with an empty lazy string.\"\"\"\n+    print(\"Testing empty lazy string...\")\n+    \n+    empty_lazy = _('')  # Empty string\n+    \n+    try:\n+        result = formats.get_format(empty_lazy)\n+        print(f\"  Result: {result}\")\n+        # Empty string should be returned as-is since it's not in FORMAT_SETTINGS\n+        if result == empty_lazy:\n+            print(\"  \u2713 Empty lazy string handled correctly\")\n+            return True\n+        else:\n+            print(f\"  \u2717 Expected {empty_lazy}, got {result}\")\n+            return False\n+    except Exception as e:\n+        print(f\"  \u2717 Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+def test_none_format_type():\n+    \"\"\"Test get_format with None as format_type.\"\"\"\n+    print(\"\\nTesting None format_type...\")\n+    \n+    try:\n+        result = formats.get_format(None)\n+        print(f\"  Result: {result}\")\n+        # None should be returned as-is since it's not in FORMAT_SETTINGS\n+        if result is None:\n+            print(\"  \u2713 None handled correctly\")\n+            return True\n+        else:\n+            print(f\"  \u2717 Expected None, got {result}\")\n+            return False\n+    except Exception as e:\n+        print(f\"  \u2717 Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+def test_lazy_non_string():\n+    \"\"\"Test get_format with a lazy object that doesn't evaluate to a string.\"\"\"\n+    print(\"\\nTesting lazy non-string...\")\n+    \n+    # Create a lazy function that returns an integer\n+    lazy_int = lazy(lambda: 123, int)()\n+    \n+    try:\n+        result = formats.get_format(lazy_int)\n+        print(f\"  Result: {result}\")\n+        # Should be returned as-is since it's not in FORMAT_SETTINGS\n+        if result == lazy_int:\n+            print(\"  \u2713 Lazy non-string handled correctly\")\n+            return True\n+        else:\n+            print(f\"  \u2717 Expected {lazy_int}, got {result}\")\n+            return False\n+    except Exception as e:\n+        print(f\"  \u2717 Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+def test_unicode_lazy_string():\n+    \"\"\"Test get_format with a lazy string containing unicode characters.\"\"\"\n+    print(\"\\nTesting unicode lazy string...\")\n+    \n+    unicode_lazy = _('\u00f1o\u00f1o-format')  # String with unicode characters\n+    \n+    try:\n+        result = formats.get_format(unicode_lazy)\n+        print(f\"  Result: {result}\")\n+        # Should return the unicode string as-is\n+        if str(result) == str(unicode_lazy):\n+            print(\"  \u2713 Unicode lazy string handled correctly\")\n+            return True\n+        else:\n+            print(f\"  \u2717 Expected {unicode_lazy}, got {result}\")\n+            return False\n+    except Exception as e:\n+        print(f\"  \u2717 Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+def test_valid_format_setting_lazy():\n+    \"\"\"Test get_format with a lazy string that matches a valid FORMAT_SETTING.\"\"\"\n+    print(\"\\nTesting valid format setting as lazy string...\")\n+    \n+    lazy_format = _('DATE_FORMAT')\n+    \n+    try:\n+        result = formats.get_format(lazy_format)\n+        print(f\"  Result: {result}\")\n+        # Should return the actual DATE_FORMAT value from settings\n+        expected = formats.get_format('DATE_FORMAT')\n+        if result == expected:\n+            print(\"  \u2713 Valid format setting lazy string handled correctly\")\n+            return True\n+        else:\n+            print(f\"  \u2717 Expected {expected}, got {result}\")\n+            return False\n+    except Exception as e:\n+        print(f\"  \u2717 Error: {type(e).__name__}: {e}\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    print(\"Testing edge cases for lazy string support in get_format...\")\n+    \n+    tests = [\n+        test_empty_lazy_string,\n+        test_none_format_type,\n+        test_lazy_non_string,\n+        test_unicode_lazy_string,\n+        test_valid_format_setting_lazy,\n+    ]\n+    \n+    all_passed = True\n+    for test in tests:\n+        if not test():\n+            all_passed = False\n+    \n+    print(f\"\\nOverall result: {'PASS' if all_passed else 'FAIL'}\")\n+    sys.exit(0 if all_passed else 1)\n\\ No newline at end of file\ndiff --git a/test_final_comprehensive.py b/test_final_comprehensive.py\nnew file mode 100644\nindex 0000000000..2ab22605b9\n--- /dev/null\n+++ b/test_final_comprehensive.py\n@@ -0,0 +1,231 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Final comprehensive test to ensure the fix works in all scenarios.\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+        TEMPLATES=[\n+            {\n+                'BACKEND': 'django.template.backends.django.DjangoTemplates',\n+                'DIRS': [],\n+                'APP_DIRS': True,\n+                'OPTIONS': {\n+                    'context_processors': [\n+                        'django.template.context_processors.debug',\n+                        'django.template.context_processors.request',\n+                        'django.contrib.auth.context_processors.auth',\n+                        'django.contrib.messages.context_processors.messages',\n+                        'django.template.context_processors.i18n',\n+                    ],\n+                },\n+            },\n+        ],\n+    )\n+\n+django.setup()\n+\n+from datetime import datetime\n+from django.template import Template, Context\n+from django.template.defaultfilters import date, time\n+from django.utils.translation import gettext_lazy as _\n+from django.utils import formats\n+from django.utils.safestring import mark_safe\n+\n+def test_original_pr_scenario():\n+    \"\"\"Test the exact scenario from the PR: some_date|date:_('Y-m-d')\"\"\"\n+    print(\"1. Testing original PR scenario...\")\n+    \n+    template = Template(\"{{ some_date|date:lazy_format }}\")\n+    context = Context({\n+        'some_date': datetime(2023, 12, 25),\n+        'lazy_format': _('Y-m-d'),\n+    })\n+    \n+    try:\n+        result = template.render(context)\n+        expected = \"2023-12-25\"\n+        assert result == expected, f\"Expected {expected}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_date_filter_direct():\n+    \"\"\"Test date filter directly with lazy format\"\"\"\n+    print(\"2. Testing date filter directly...\")\n+    \n+    test_date = datetime(2023, 12, 25, 14, 30)\n+    lazy_format = _('Y-m-d H:i')\n+    \n+    try:\n+        result = date(test_date, lazy_format)\n+        expected = \"2023-12-25 14:30\"\n+        assert result == expected, f\"Expected {expected}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_time_filter_with_lazy():\n+    \"\"\"Test time filter with lazy format\"\"\"\n+    print(\"3. Testing time filter with lazy format...\")\n+    \n+    test_time = datetime(2023, 12, 25, 14, 30, 45)\n+    lazy_format = _('H:i:s')\n+    \n+    try:\n+        result = time(test_time, lazy_format)\n+        expected = \"14:30:45\"\n+        assert result == expected, f\"Expected {expected}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_get_format_with_lazy_setting():\n+    \"\"\"Test get_format with lazy format setting name\"\"\"\n+    print(\"4. Testing get_format with lazy setting name...\")\n+    \n+    lazy_setting = _('DATE_FORMAT')\n+    \n+    try:\n+        result = formats.get_format(lazy_setting)\n+        expected = formats.get_format('DATE_FORMAT')\n+        assert result == expected, f\"Expected {expected}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_get_format_with_lazy_custom():\n+    \"\"\"Test get_format with lazy custom format\"\"\"\n+    print(\"5. Testing get_format with lazy custom format...\")\n+    \n+    lazy_custom = _('custom-Y-m-d')\n+    \n+    try:\n+        result = formats.get_format(lazy_custom)\n+        # Should return the lazy object as-is since it's not a setting\n+        assert str(result) == str(lazy_custom), f\"Expected {lazy_custom}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_mark_safe_with_lazy():\n+    \"\"\"Test that mark_safe + lazy strings work with date filter\"\"\"\n+    print(\"6. Testing mark_safe with lazy strings...\")\n+    \n+    test_date = datetime(2023, 12, 25)\n+    safe_lazy_format = mark_safe(_('Y-m-d'))\n+    \n+    try:\n+        result = date(test_date, safe_lazy_format)\n+        expected = \"2023-12-25\"\n+        assert result == expected, f\"Expected {expected}, got {result}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_caching_with_lazy():\n+    \"\"\"Test that caching works correctly with lazy strings\"\"\"\n+    print(\"7. Testing caching with lazy strings...\")\n+    \n+    lazy_format = _('Y-m-d')\n+    \n+    try:\n+        # Clear cache first\n+        formats.reset_format_cache()\n+        \n+        # Call twice to test caching\n+        result1 = formats.get_format(lazy_format)\n+        result2 = formats.get_format(lazy_format)\n+        \n+        assert result1 == result2, f\"Caching failed: {result1} != {result2}\"\n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+def test_multiple_lazy_formats():\n+    \"\"\"Test multiple different lazy formats\"\"\"\n+    print(\"8. Testing multiple lazy formats...\")\n+    \n+    test_date = datetime(2023, 12, 25, 14, 30, 45)\n+    \n+    test_cases = [\n+        (_('Y-m-d'), '2023-12-25'),\n+        (_('d/m/Y'), '25/12/2023'),\n+        (_('F j, Y'), 'December 25, 2023'),\n+        (_('H:i'), '14:30'),\n+        (_('g:i A'), '2:30 PM'),\n+    ]\n+    \n+    try:\n+        for lazy_format, expected in test_cases:\n+            if 'H' in str(lazy_format) or 'g' in str(lazy_format):\n+                result = time(test_date, lazy_format)\n+            else:\n+                result = date(test_date, lazy_format)\n+            assert result == expected, f\"Format {lazy_format}: expected {expected}, got {result}\"\n+        \n+        print(\"   \u2713 PASS\")\n+        return True\n+    except Exception as e:\n+        print(f\"   \u2717 FAIL: {e}\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    print(\"Running final comprehensive test suite...\")\n+    print(\"=\" * 50)\n+    \n+    tests = [\n+        test_original_pr_scenario,\n+        test_date_filter_direct,\n+        test_time_filter_with_lazy,\n+        test_get_format_with_lazy_setting,\n+        test_get_format_with_lazy_custom,\n+        test_mark_safe_with_lazy,\n+        test_caching_with_lazy,\n+        test_multiple_lazy_formats,\n+    ]\n+    \n+    passed = 0\n+    total = len(tests)\n+    \n+    for test in tests:\n+        if test():\n+            passed += 1\n+    \n+    print(\"=\" * 50)\n+    print(f\"Results: {passed}/{total} tests passed\")\n+    \n+    if passed == total:\n+        print(\"\ud83c\udf89 ALL TESTS PASSED! The fix is working correctly.\")\n+        sys.exit(0)\n+    else:\n+        print(\"\u274c Some tests failed!\")\n+        sys.exit(1)\n\\ No newline at end of file\ndiff --git a/test_lazy_dict.py b/test_lazy_dict.py\nnew file mode 100644\nindex 0000000000..56e3488b7b\n--- /dev/null\n+++ b/test_lazy_dict.py\n@@ -0,0 +1,66 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Test if dictionary operations work with lazy strings.\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+    )\n+\n+django.setup()\n+\n+from django.utils.translation import gettext_lazy as _\n+\n+def test_dict_operations():\n+    \"\"\"Test dictionary operations with lazy strings.\"\"\"\n+    \n+    # Create a test dictionary\n+    test_dict = {\n+        'DATE_INPUT_FORMATS': ['%Y-%m-%d'],\n+        'TIME_INPUT_FORMATS': ['%H:%M:%S'],\n+    }\n+    \n+    # Create lazy strings\n+    lazy_key1 = _('DATE_INPUT_FORMATS')\n+    lazy_key2 = _('NONEXISTENT_KEY')\n+    \n+    print(f\"Test dict: {test_dict}\")\n+    print(f\"Lazy key 1: {lazy_key1} (type: {type(lazy_key1)})\")\n+    print(f\"Lazy key 2: {lazy_key2} (type: {type(lazy_key2)})\")\n+    \n+    # Test 'in' operator\n+    try:\n+        result1 = lazy_key1 in test_dict\n+        print(f\"lazy_key1 in test_dict: {result1}\")\n+    except Exception as e:\n+        print(f\"Error with 'in' operator: {e}\")\n+    \n+    # Test get() method\n+    try:\n+        result2 = test_dict.get(lazy_key1, [])\n+        print(f\"test_dict.get(lazy_key1, []): {result2}\")\n+    except Exception as e:\n+        print(f\"Error with get() method: {e}\")\n+    \n+    try:\n+        result3 = test_dict.get(lazy_key2, [])\n+        print(f\"test_dict.get(lazy_key2, []): {result3}\")\n+    except Exception as e:\n+        print(f\"Error with get() method for nonexistent key: {e}\")\n+\n+if __name__ == \"__main__\":\n+    test_dict_operations()\n\\ No newline at end of file\ndiff --git a/test_pr_scenario.py b/test_pr_scenario.py\nnew file mode 100644\nindex 0000000000..2c5b82be61\n--- /dev/null\n+++ b/test_pr_scenario.py\n@@ -0,0 +1,114 @@\n+#!/usr/bin/env python\n+\"\"\"\n+Test the exact scenario mentioned in the PR description:\n+some_date|date:_('Y-m-d')\n+\"\"\"\n+import os\n+import sys\n+import django\n+from django.conf import settings\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        DEBUG=True,\n+        USE_I18N=True,\n+        USE_L10N=True,\n+        LANGUAGE_CODE='en-us',\n+        INSTALLED_APPS=[\n+            'django.contrib.contenttypes',\n+            'django.contrib.auth',\n+        ],\n+        SECRET_KEY='test-secret-key',\n+        TEMPLATES=[\n+            {\n+                'BACKEND': 'django.template.backends.django.DjangoTemplates',\n+                'DIRS': [],\n+                'APP_DIRS': True,\n+                'OPTIONS': {\n+                    'context_processors': [\n+                        'django.template.context_processors.debug',\n+                        'django.template.context_processors.request',\n+                        'django.contrib.auth.context_processors.auth',\n+                        'django.contrib.messages.context_processors.messages',\n+                        'django.template.context_processors.i18n',\n+                    ],\n+                },\n+            },\n+        ],\n+    )\n+\n+django.setup()\n+\n+from datetime import datetime\n+from django.template import Template, Context\n+from django.utils.translation import gettext_lazy as _\n+\n+def test_template_with_lazy_format():\n+    \"\"\"Test the exact scenario from the PR: some_date|date:_('Y-m-d')\"\"\"\n+    print(\"Testing template with lazy format string...\")\n+    \n+    # Create a template that uses a lazy string for date formatting\n+    template_string = \"{{ some_date|date:lazy_format }}\"\n+    template = Template(template_string)\n+    \n+    # Create context with a date and a lazy format string\n+    context = Context({\n+        'some_date': datetime(2023, 12, 25, 14, 30, 45),\n+        'lazy_format': _('Y-m-d'),\n+    })\n+    \n+    try:\n+        result = template.render(context)\n+        print(f\"Template rendered successfully: '{result}'\")\n+        \n+        # Verify the result is correct\n+        expected = \"2023-12-25\"\n+        if result == expected:\n+            print(f\"\u2713 Result matches expected: {expected}\")\n+            return True\n+        else:\n+            print(f\"\u2717 Result '{result}' does not match expected '{expected}'\")\n+            return False\n+    except Exception as e:\n+        print(f\"\u2717 Template rendering failed: {type(e).__name__}: {e}\")\n+        return False\n+\n+def test_template_with_literal_lazy_format():\n+    \"\"\"Test template with literal lazy format in the template itself\"\"\"\n+    print(\"\\nTesting template with literal lazy format...\")\n+    \n+    # This would be more complex to test as it requires template compilation\n+    # with internationalization, but we can test the underlying functionality\n+    from django.template.defaultfilters import date\n+    \n+    test_date = datetime(2023, 12, 25, 14, 30, 45)\n+    lazy_format = _('Y-m-d')\n+    \n+    try:\n+        result = date(test_date, lazy_format)\n+        print(f\"Date filter with lazy format: '{result}'\")\n+        \n+        expected = \"2023-12-25\"\n+        if result == expected:\n+            print(f\"\u2713 Result matches expected: {expected}\")\n+            return True\n+        else:\n+            print(f\"\u2717 Result '{result}' does not match expected '{expected}'\")\n+            return False\n+    except Exception as e:\n+        print(f\"\u2717 Date filter failed: {type(e).__name__}: {e}\")\n+        return False\n+\n+if __name__ == \"__main__\":\n+    print(\"Testing the exact PR scenario: some_date|date:_('Y-m-d')\")\n+    \n+    test1_passed = test_template_with_lazy_format()\n+    test2_passed = test_template_with_literal_lazy_format()\n+    \n+    if test1_passed and test2_passed:\n+        print(\"\\n\u2713 All tests passed! The PR issue has been fixed.\")\n+        sys.exit(0)\n+    else:\n+        print(\"\\n\u2717 Some tests failed!\")\n+        sys.exit(1)\n\\ No newline at end of file\n"}