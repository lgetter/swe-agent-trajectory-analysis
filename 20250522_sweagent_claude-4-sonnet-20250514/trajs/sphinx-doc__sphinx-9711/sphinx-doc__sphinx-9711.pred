{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "sphinx-doc__sphinx-9711", "model_patch": "diff --git a/sphinx/application.py b/sphinx/application.py\nindex 4a75a83fe..cbda8c6cd 100644\n--- a/sphinx/application.py\n+++ b/sphinx/application.py\n@@ -402,8 +402,15 @@ class Sphinx:\n \n         .. versionadded:: 1.0\n         \"\"\"\n-        if version > sphinx.__display_version__[:3]:\n-            raise VersionRequirementError(version)\n+        # Use proper version comparison instead of string comparison\n+        try:\n+            from packaging import version as packaging_version\n+            if packaging_version.parse(version) > packaging_version.parse(sphinx.__display_version__[:3]):\n+                raise VersionRequirementError(version)\n+        except Exception:\n+            # Fall back to string comparison if version parsing fails\n+            if version > sphinx.__display_version__[:3]:\n+                raise VersionRequirementError(version)\n \n     # event interface\n     def connect(self, event: str, callback: Callable, priority: int = 500) -> int:\ndiff --git a/sphinx/extension.py b/sphinx/extension.py\nindex 7ec6c8518..f0f5f9c57 100644\n--- a/sphinx/extension.py\n+++ b/sphinx/extension.py\n@@ -10,6 +10,8 @@\n \n from typing import TYPE_CHECKING, Any, Dict\n \n+from packaging import version\n+\n from sphinx.config import Config\n from sphinx.errors import VersionRequirementError\n from sphinx.locale import __\n@@ -51,11 +53,31 @@ def verify_needs_extensions(app: \"Sphinx\", config: Config) -> None:\n                               'but it is not loaded.'), extname)\n             continue\n \n-        if extension.version == 'unknown version' or reqversion > extension.version:\n+        if extension.version == 'unknown version':\n             raise VersionRequirementError(__('This project needs the extension %s at least in '\n                                              'version %s and therefore cannot be built with '\n                                              'the loaded version (%s).') %\n                                           (extname, reqversion, extension.version))\n+        \n+        # Use proper version comparison instead of string comparison\n+        try:\n+            req_parsed = version.parse(reqversion)\n+            ext_parsed = version.parse(extension.version)\n+            if req_parsed > ext_parsed:\n+                raise VersionRequirementError(__('This project needs the extension %s at least in '\n+                                                 'version %s and therefore cannot be built with '\n+                                                 'the loaded version (%s).') %\n+                                              (extname, reqversion, extension.version))\n+        except VersionRequirementError:\n+            # Re-raise version requirement errors\n+            raise\n+        except Exception:\n+            # Fall back to string comparison if version parsing fails\n+            if reqversion > extension.version:\n+                raise VersionRequirementError(__('This project needs the extension %s at least in '\n+                                                 'version %s and therefore cannot be built with '\n+                                                 'the loaded version (%s).') %\n+                                              (extname, reqversion, extension.version))\n \n \n def setup(app: \"Sphinx\") -> Dict[str, Any]:\n"}