{"model_name_or_path": "250522_anthropic_filemap_simple_review__claude-sonnet-4-20250514__t-0.00__p-1.00__c-3.00___swe_bench_verified_test", "instance_id": "django__django-12774", "model_patch": "diff --git a/django/db/models/query.py b/django/db/models/query.py\nindex d9c9b0db04..8632a5e7b0 100644\n--- a/django/db/models/query.py\n+++ b/django/db/models/query.py\n@@ -16,6 +16,7 @@ from django.db import (\n     router, transaction,\n )\n from django.db.models import AutoField, DateField, DateTimeField, sql\n+from django.db.models.constraints import UniqueConstraint\n from django.db.models.constants import LOOKUP_SEP\n from django.db.models.deletion import Collector\n from django.db.models.expressions import Case, Expression, F, Value, When\n@@ -682,6 +683,25 @@ class QuerySet:\n         for obj in (self.reverse() if self.ordered else self.order_by('-pk'))[:1]:\n             return obj\n \n+    def _is_field_unique(self, field_name):\n+        \"\"\"\n+        Check if a field is unique either through field.unique=True or through\n+        a single-field UniqueConstraint without conditions.\n+        \"\"\"\n+        # Check if field has unique=True\n+        field = self.model._meta.get_field(field_name)\n+        if field.unique:\n+            return True\n+        \n+        # Check if field is covered by a single-field UniqueConstraint without conditions\n+        for constraint in self.model._meta.total_unique_constraints:\n+            if (len(constraint.fields) == 1 and \n+                constraint.fields[0] == field_name and \n+                constraint.condition is None):\n+                return True\n+        \n+        return False\n+\n     def in_bulk(self, id_list=None, *, field_name='pk'):\n         \"\"\"\n         Return a dictionary mapping each of the given IDs to the object with\n@@ -689,7 +709,7 @@ class QuerySet:\n         \"\"\"\n         assert not self.query.is_sliced, \\\n             \"Cannot use 'limit' or 'offset' with in_bulk\"\n-        if field_name != 'pk' and not self.model._meta.get_field(field_name).unique:\n+        if field_name != 'pk' and not self._is_field_unique(field_name):\n             raise ValueError(\"in_bulk()'s field_name must be a unique field but %r isn't.\" % field_name)\n         if id_list is not None:\n             if not id_list:\ndiff --git a/tests/lookup/models.py b/tests/lookup/models.py\nindex fbc9fa606f..6921d0a37d 100644\n--- a/tests/lookup/models.py\n+++ b/tests/lookup/models.py\n@@ -108,3 +108,14 @@ class Freebie(models.Model):\n         to_fields=['id', 'product'],\n         on_delete=models.CASCADE,\n     )\n+\n+\n+class UniqueConstraintArticle(models.Model):\n+    \"\"\"Model to test in_bulk() with UniqueConstraint instead of unique=True.\"\"\"\n+    headline = models.CharField(max_length=100)\n+    slug = models.CharField(max_length=100)  # Not unique=True, but has UniqueConstraint\n+    \n+    class Meta:\n+        constraints = [\n+            models.UniqueConstraint(fields=['slug'], name='lookup_uniqueconstraintarticle_slug_unq')\n+        ]\ndiff --git a/tests/lookup/tests.py b/tests/lookup/tests.py\nindex baefdf9701..708dccd703 100644\n--- a/tests/lookup/tests.py\n+++ b/tests/lookup/tests.py\n@@ -12,6 +12,7 @@ from django.utils.deprecation import RemovedInDjango40Warning\n \n from .models import (\n     Article, Author, Freebie, Game, IsNullWithNoneAsRHS, Player, Season, Tag,\n+    UniqueConstraintArticle,\n )\n \n \n@@ -194,6 +195,32 @@ class LookupTests(TestCase):\n         with self.assertRaisesMessage(ValueError, msg):\n             Article.objects.in_bulk([self.au1], field_name='author')\n \n+    def test_in_bulk_with_unique_constraint(self):\n+        \"\"\"Test that in_bulk() works with fields that have UniqueConstraint.\"\"\"\n+        # Create test objects with UniqueConstraint\n+        uca1 = UniqueConstraintArticle.objects.create(headline='UCA 1', slug='uca1')\n+        uca2 = UniqueConstraintArticle.objects.create(headline='UCA 2', slug='uca2')\n+        uca3 = UniqueConstraintArticle.objects.create(headline='UCA 3', slug='uca3')\n+        \n+        # Test in_bulk with specific slugs\n+        result = UniqueConstraintArticle.objects.in_bulk(\n+            [uca1.slug, uca3.slug], field_name='slug'\n+        )\n+        expected = {uca1.slug: uca1, uca3.slug: uca3}\n+        self.assertEqual(result, expected)\n+        \n+        # Test in_bulk with all objects\n+        result = UniqueConstraintArticle.objects.in_bulk(field_name='slug')\n+        expected = {uca1.slug: uca1, uca2.slug: uca2, uca3.slug: uca3}\n+        self.assertEqual(result, expected)\n+        \n+        # Test with non-existent slugs\n+        result = UniqueConstraintArticle.objects.in_bulk(\n+            ['non-existent', uca2.slug], field_name='slug'\n+        )\n+        expected = {uca2.slug: uca2}\n+        self.assertEqual(result, expected)\n+\n     def test_values(self):\n         # values() returns a list of dictionaries instead of object instances --\n         # and you can specify which fields you want to retrieve.\n"}